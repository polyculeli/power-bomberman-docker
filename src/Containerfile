FROM debian:13.1-slim@sha256:1caf1c703c8f7e15dcf2e7769b35000c764e6f50e4d7401c355fb0248f3ddfdb AS builder

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    megatools unzip && \
    apt-get clean

WORKDIR /pbserver

RUN megadl https://mega.nz/file/mPZSgS4T#3vnm7zR2Tz3ZANt0tnFaorMy4f7j9cpVjgRvMQI0qeo && \
    unzip powerbomberman077c_server.zip && \
    rm powerbomberman077c_server.zip


FROM debian:13.1-slim@sha256:1caf1c703c8f7e15dcf2e7769b35000c764e6f50e4d7401c355fb0248f3ddfdb AS main

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    mono-devel && \
    apt-get clean

WORKDIR /pbserver

copy --from=builder /pbserver /pbserver/

COPY entrypoint.sh entrypoint.sh

EXPOSE 64640

ENTRYPOINT ["./entrypoint.sh"]
